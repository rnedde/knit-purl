<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Knitting Yarn Shader Minimal</title>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>
</head>
<body>
<script id="fragShader" type="x-shader/x-fragment">
precision mediump float;

uniform float u_time;
uniform vec2 u_resolution;

void main() {
  vec2 uv = gl_FragCoord.xy / u_resolution.xy;

  // Repeat grid 10 x 20
  vec2 gridUV = fract(uv * vec2(10.0, 20.0));

  // Center each stitch cell [-0.5, 0.5]
  vec2 center = gridUV - 0.5;

  // Draw a circular loop shape in the stitch cell
  float dist = length(center);

  // Outer loop ring
  float outer = smoothstep(0.5, 0.45, dist);
  // Inner hole
  float inner = smoothstep(0.15, 0.12, dist);

  float loop = outer - inner;

  // Animate yarn twist with sine wave horizontally + time
  float twist = 0.5 + 0.5 * sin(gridUV.x * 20.0 * 3.1415 + u_time * 5.0);

  float colorMix = loop * twist;

  // Base yarn color tan and highlight
  vec3 baseColor = vec3(0.85, 0.7, 0.5);
  vec3 highlight = vec3(1.0, 0.9, 0.7);

  vec3 color = mix(baseColor, highlight, colorMix);

  gl_FragColor = vec4(color, 1.0);
}
</script>

<script>
let theShader;
const vertShader = `
  precision mediump float;
  attribute vec3 aPosition;
  attribute vec2 aTexCoord;
  varying vec2 vTexCoord;
  void main() {
    vTexCoord = aTexCoord;
    gl_Position = vec4(aPosition, 1.0);
  }
`;

function preload() {
  theShader = new p5.Shader(this._renderer, vertShader, document.getElementById('fragShader').textContent);
}

function setup() {
  createCanvas(windowWidth, windowHeight, WEBGL);
  noStroke();
  shader(theShader);
}

function draw() {
  theShader.setUniform('u_time', millis() / 1000.0);
  theShader.setUniform('u_resolution', [width, height]);
  plane(width, height);
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
}
</script>
</body>
</html>
